name: $(TeamProject)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

pool:
  vmImage: 'Ubuntu-16.04'

steps:

- task: NodeTool@0
  inputs:
    versionSpec: 10.x
  displayName: Install Node.js

- script: npm install
  displayName: API Install
  workingDirectory: api

- script: npm run-script build
  displayName: API Build
  workingDirectory: api

- task: PublishPipelineArtifact@0
  displayName: API Artifact
  inputs:
    artifactName: api
    targetPath: api

- script: npm link ../api
  displayName: CLI Link API
  workingDirectory: cli

- script: npm install
  displayName: CLI Install
  workingDirectory: cli

- task: PublishPipelineArtifact@0
  displayName: Debug Artifact
  inputs:
    artifactName: debug
    targetPath: $(Build.Repository.LocalPath)

- script: npm run-script build
  displayName: CLI Build
  workingDirectory: cli

- task: PublishPipelineArtifact@0
  displayName: CLI Artifact
  inputs:
    artifactName: cli
    targetPath: cli
