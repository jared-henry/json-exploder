name: $(TeamProject)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

pool:
  vmImage: 'Ubuntu-16.04'

steps:

- task: NodeTool@0
  displayName: Install Node.js
  inputs:
    versionSpec: 10.x 

- script: |
    npm install
    npm run-script build
    npm pack
  displayName: API Build and Pack

- script: |
    npm link ../api
    npm install
    npm run-script build
    npm pack 
  displayName: CLI Build and Pack

- task: CopyFiles@2
  displayName: Copy npm packages to staging directory
  inputs:
    contents: '*/*.tgz'
    targetFolder: $(Build.ArtifactStagingDirectory)/packages
    flattenFolders: true
  
- task: PublishPipelineArtifact@0
  displayName: Publish Artifacts
  inputs:
    artifactName: packages
    targetPath: $(Build.ArtifactStagingDirectory)/packages
