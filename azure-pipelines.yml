name: $(TeamProject)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

pool:
  vmImage: 'Ubuntu-16.04'

steps:

- script: sudo npm link
  displayName: API Link
  workingDirectory: api

- script: sudo npm install
  displayName: API Install
  workingDirectory: api

- script: sudo npm run-script build
  displayName: API Build
  workingDirectory: api

- task: PublishPipelineArtifact@0
  displayName: API Artifact
  inputs:
    artifactName: api
    targetPath: api

- script: sudo npm link @json-exploder/api
  displayName: CLI Link API
  workingDirectory: cli

- script: sudo npm install
  displayName: CLI Install
  workingDirectory: cli


- task: PublishPipelineArtifact@0
  displayName: CLI Artifact
  inputs:
    artifactName: cli-before-build
    targetPath: cli

- script: sudo npm run-script build
  displayName: CLI Build
  workingDirectory: cli

- task: PublishPipelineArtifact@0
  displayName: CLI Artifact
  inputs:
    artifactName: cli
    targetPath: cli
